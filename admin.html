<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯¦é©—å®¤å¾Œå°ç®¡ç†ç³»çµ± (Admin Dashboard)</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <style>
        body { font-family: "Microsoft JhengHei", "Heiti TC", sans-serif; overflow-x: hidden; }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        /* å¹³æ»‘ç§»å‹•å‹•ç•« */
        .sidebar-transition { transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        input[type="date"]::-webkit-calendar-picker-indicator { cursor: pointer; opacity: 0.6; }
    </style>
</head>
<body class="bg-slate-100">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- Icons ---
        const MenuIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></svg>;
        const CloseIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>;

        const TAB_NAMES = { 
            news: 'æœ€æ–°æ¶ˆæ¯', 
            projects: 'è¨ˆç•«ç®¡ç†', 
            members: 'æˆå“¡ç®¡ç†', 
            publications: 'ç™¼è¡¨è«–æ–‡', 
            gallery: 'ç”Ÿæ´»å¯«çœŸ' 
        };

        const supabaseUrl = "https://uyvyxkrikmdyypppqsdt.supabase.co"; 
        const supabaseKey = "sb_publishable_AR5cKUsnsxgFRcC1rDCWlQ_mYRrxVUC"; 

        const getCredentials = () => ({ 
            username: localStorage.getItem('smsmp_admin_user') || 'yflin', 
            password: localStorage.getItem('smsmp_admin_pass') || '0701' 
        });

        const updateCredentials = (u, p) => {
            localStorage.setItem('smsmp_admin_user', u);
            localStorage.setItem('smsmp_admin_pass', p);
        };

        const compressImage = (file) => {
            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = (e) => {
                    const img = new Image();
                    img.src = e.target.result;
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const MAX = 800;
                        let w = img.width, h = img.height;
                        if (w > h) { if (w > MAX) { h *= MAX / w; w = MAX; } }
                        else { if (h > MAX) { w *= MAX / h; h = MAX; } }
                        canvas.width = w; canvas.height = h;
                        canvas.getContext('2d').drawImage(img, 0, 0, w, h);
                        resolve(canvas.toDataURL('image/jpeg', 0.7));
                    };
                };
            });
        };

        const fileToBase64 = (file) => {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            });
        };

        // --- ç™»å…¥ä»‹é¢ ---
        const LoginForm = ({ onLogin }) => {
            const [u, setU] = useState('');
            const [p, setP] = useState('');
            const [err, setErr] = useState('');
            const handleSubmit = (e) => {
                e.preventDefault();
                const creds = getCredentials();
                if (u === creds.username && p === creds.password) onLogin();
                else setErr('å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤');
            };
            return (
                <div className="min-h-screen flex items-center justify-center bg-slate-900 p-4">
                    <div className="bg-white p-8 md:p-10 rounded-[32px] shadow-2xl w-full max-w-sm border border-slate-200">
                        <div className="text-center mb-8">
                            <h2 className="text-2xl font-black text-slate-800 tracking-tight">SMSMP Lab å¾Œå°</h2>
                            <p className="text-slate-400 text-sm mt-2">ç®¡ç†ç³»çµ±ç™»å…¥</p>
                        </div>
                        <form onSubmit={handleSubmit} className="space-y-4">
                            <input className="w-full border-2 border-slate-100 p-4 rounded-2xl focus:border-blue-500 outline-none transition-all" placeholder="ç®¡ç†å¸³è™Ÿ" value={u} onChange={e=>setU(e.target.value)} required />
                            <input className="w-full border-2 border-slate-100 p-4 rounded-2xl focus:border-blue-500 outline-none transition-all" type="password" placeholder="ç®¡ç†å¯†ç¢¼" value={p} onChange={e=>setP(e.target.value)} required />
                            {err && <p className="text-red-500 text-center text-sm font-bold bg-red-50 py-2 rounded-xl">{err}</p>}
                            <button className="w-full bg-blue-600 text-white py-4 rounded-2xl font-black hover:bg-blue-700 transition-all shadow-xl shadow-blue-200">é€²å…¥ç³»çµ±</button>
                        </form>
                    </div>
                </div>
            );
        };

        // --- ä¿®æ”¹å¯†ç¢¼è¦–çª— ---
        const ChangePasswordModal = ({ isOpen, onClose }) => {
            const [oldPass, setOldPass] = useState('');
            const [newPass, setNewPass] = useState('');
            const [confirmPass, setConfirmPass] = useState('');
            const [msg, setMsg] = useState({ type: '', text: '' });

            const handleSubmit = (e) => {
                e.preventDefault();
                const current = getCredentials();
                if (oldPass !== current.password) {
                    setMsg({ type: 'error', text: 'èˆŠå¯†ç¢¼é©—è­‰å¤±æ•—' });
                    return;
                }
                if (newPass !== confirmPass) {
                    setMsg({ type: 'error', text: 'æ–°å¯†ç¢¼èˆ‡ç¢ºèªå¯†ç¢¼ä¸ç¬¦' });
                    return;
                }
                updateCredentials(current.username, newPass);
                setMsg({ type: 'success', text: 'ä¿®æ”¹æˆåŠŸï¼å³å°‡é‡æ–°ç™»å…¥...' });
                setTimeout(() => window.location.reload(), 1500);
            };

            if (!isOpen) return null;

            return (
                <div className="fixed inset-0 bg-black/60 flex items-center justify-center z-[100] p-4 backdrop-blur-sm">
                    <div className="bg-white rounded-[32px] shadow-2xl w-full max-w-md p-6 md:p-8">
                        <h3 className="text-xl font-black mb-6 text-slate-800 flex items-center gap-2">ğŸ”’ ä¿®æ”¹ç®¡ç†å¯†ç¢¼</h3>
                        {msg.text && <div className={`p-4 mb-6 rounded-2xl text-sm font-bold ${msg.type==='error'?'bg-red-50 text-red-600':'bg-green-50 text-green-600'}`}>{msg.text}</div>}
                        <form onSubmit={handleSubmit} className="space-y-4">
                            <div className="bg-slate-50 p-4 rounded-2xl border border-slate-100">
                                <label className="block text-xs font-bold text-slate-400 mb-2 uppercase">é©—è­‰ç•¶å‰å¯†ç¢¼</label>
                                <input type="password" placeholder="è«‹è¼¸å…¥èˆŠå¯†ç¢¼" value={oldPass} onChange={e => setOldPass(e.target.value)} className="w-full border-2 border-white p-3 rounded-xl focus:border-blue-300 outline-none" required />
                            </div>
                            <div className="bg-blue-50 p-4 rounded-2xl border border-blue-100">
                                <label className="block text-xs font-bold text-blue-400 mb-2 uppercase">è¨­å®šæ–°å¯†ç¢¼</label>
                                <input type="password" placeholder="è¼¸å…¥æ–°å¯†ç¢¼" value={newPass} onChange={e => setNewPass(e.target.value)} className="w-full border-2 border-white p-3 rounded-xl mb-3 focus:border-blue-300 outline-none" required />
                                <input type="password" placeholder="å†æ¬¡ç¢ºèªæ–°å¯†ç¢¼" value={confirmPass} onChange={e => setConfirmPass(e.target.value)} className="w-full border-2 border-white p-3 rounded-xl focus:border-blue-300 outline-none" required />
                            </div>
                            <div className="flex justify-end gap-3 mt-8">
                                <button type="button" onClick={onClose} className="px-6 py-3 border rounded-xl font-bold">å–æ¶ˆ</button>
                                <button type="submit" className="px-6 py-3 bg-blue-600 text-white rounded-xl font-black">å„²å­˜è®Šæ›´</button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        };

        // --- ç·¨è¼¯è¦–çª— ---
        const EditorModal = ({ activeTab, initData, onSave, onBatchSave, onClose }) => {
            const [formData, setFormData] = useState({ dateMode: 'single', ...initData });
            const [galleryImages, setGalleryImages] = useState([]);
            const [isSaving, setIsSaving] = useState(false);
            const [fileError, setFileError] = useState('');
            const MAX_FILE_SIZE = 2 * 1024 * 1024; // 2MB

            const handleFile = async (e) => {
                setFileError('');
                const files = Array.from(e.target.files);
                if (files.length === 0) return;

                if (activeTab === 'publications') {
                    if (files[0].size > MAX_FILE_SIZE) {
                        setFileError('æª”æ¡ˆå¤ªå¤§ï¼è«‹ä¸Šå‚³å°æ–¼ 2MB çš„ PDFã€‚');
                        e.target.value = null; return;
                    }
                    const base64 = await fileToBase64(files[0]);
                    setFormData(p => ({ ...p, pdfFile: base64, pdfName: files[0].name }));
                } else {
                    const compressed = await Promise.all(files.map(f => compressImage(f)));
                    if (activeTab === 'gallery') setGalleryImages(prev => [...prev, ...compressed.map(src => ({src}))]);
                    else setFormData(p => ({ ...p, [activeTab === 'members' ? 'photo' : 'image']: compressed[0] }));
                }
            };

            const handleSubmit = async (e) => {
                e.preventDefault();
                setIsSaving(true);
                try {
                    if (activeTab === 'gallery' && !formData.id && galleryImages.length > 1) {
                        const items = galleryImages.map((img, idx) => ({ ...formData, src: img.src, createdAt: Date.now() - idx * 1000 }));
                        await onBatchSave(items);
                    } else {
                        await onSave(formData);
                    }
                    onClose();
                } catch (err) { alert("å„²å­˜å¤±æ•—"); }
                finally { setIsSaving(false); }
            };

            return (
                <div className="fixed inset-0 bg-black/60 flex items-center justify-center z-[110] p-4 backdrop-blur-sm overflow-y-auto custom-scrollbar">
                    <div className="bg-white rounded-[32px] shadow-2xl w-full max-w-2xl p-6 md:p-10 relative my-auto">
                        <h3 className="text-2xl md:text-3xl font-black mb-6 text-slate-800">{formData.id ? 'ç·¨è¼¯' : 'æ–°å¢'}{TAB_NAMES[activeTab]}</h3>
                        <form onSubmit={handleSubmit} className="space-y-5">
                            
                            <div>
                                <label className="block text-sm font-bold text-slate-700 mb-2">ä¸»è¦åç¨± / æ¨™é¡Œ</label>
                                <input required value={formData.title || formData.name || ''} onChange={e=>setFormData({...formData, [activeTab==='members'?'name':'title']:e.target.value})} className="w-full border-2 border-slate-100 p-3 md:p-4 rounded-2xl focus:border-blue-500 outline-none font-bold" />
                            </div>

                            {activeTab === 'projects' && (
                                <div className="grid grid-cols-2 gap-4">
                                    <div className="col-span-1">
                                        <label className="block text-xs font-bold text-slate-500 mb-1">è¨ˆç•«å¹´åº¦</label>
                                        <input placeholder="113" value={formData.planYear || ''} onChange={e=>setFormData({...formData, planYear:e.target.value})} className="w-full border-2 border-slate-100 p-3 rounded-2xl focus:border-blue-500 outline-none" />
                                    </div>
                                    <div className="col-span-1">
                                        <label className="block text-xs font-bold text-slate-500 mb-1">åŸ·è¡Œå¹´åº¦</label>
                                        <input placeholder="113-114" value={formData.execYear || ''} onChange={e=>setFormData({...formData, execYear:e.target.value})} className="w-full border-2 border-slate-100 p-3 rounded-2xl focus:border-blue-500 outline-none" />
                                    </div>

                                    <div className="col-span-2 space-y-3">
                                        <div className="flex gap-2">
                                            <button type="button" onClick={()=>setFormData({...formData, dateMode: 'single'})} className={`flex-1 py-2 text-xs rounded-lg font-bold border-2 transition-all ${formData.dateMode==='single'?'bg-blue-600 border-blue-600 text-white':'bg-white text-slate-400'}`}>å–®ä¸€æ—¥æœŸ</button>
                                            <button type="button" onClick={()=>setFormData({...formData, dateMode: 'range'})} className={`flex-1 py-2 text-xs rounded-lg font-bold border-2 transition-all ${formData.dateMode==='range'?'bg-blue-600 border-blue-600 text-white':'bg-white text-slate-400'}`}>æ™‚é–“åˆ†æ®µ</button>
                                        </div>
                                        <div className="grid grid-cols-2 gap-3 bg-slate-50 p-4 rounded-2xl">
                                            <input type="date" required value={formData.startDate || ''} onChange={e=>{
                                                const d = e.target.value;
                                                const y = d ? (new Date(d).getFullYear() - 1911) : '';
                                                setFormData({...formData, startDate: d, year: y.toString(), planYear: formData.planYear || y.toString()});
                                            }} className="w-full border-2 border-white p-2 rounded-xl text-sm" />
                                            {formData.dateMode === 'range' && <input type="date" required value={formData.endDate || ''} onChange={e=>setFormData({...formData, endDate:e.target.value})} className="w-full border-2 border-white p-2 rounded-xl text-sm" />}
                                        </div>
                                    </div>

                                    <div className="col-span-2">
                                        <label className="block text-xs font-bold text-slate-500 mb-1">æ¨™ç±¤èˆ‡å–®ä½</label>
                                        <div className="flex flex-col gap-3">
                                            <select value={formData.type || 'government'} onChange={e=>setFormData({...formData, type:e.target.value})} className="w-full border-2 border-slate-100 p-3 rounded-2xl text-sm">
                                                <option value="government">åœ‹ç§‘æœƒ / æ•™è‚²éƒ¨è¨ˆç•«</option><option value="industry">ç”¢å­¸åˆä½œè¨ˆç•«</option><option value="research">ä¸€èˆ¬ç ”ç©¶è¨ˆç•«</option>
                                            </select>
                                            <input placeholder="å§”è¨—å–®ä½" value={formData.agency||''} onChange={e=>setFormData({...formData, agency:e.target.value})} className="w-full border-2 border-slate-100 p-3 rounded-2xl text-sm" />
                                            <input placeholder="ä¸»æŒäºº" value={formData.role||''} onChange={e=>setFormData({...formData, role:e.target.value})} className="w-full border-2 border-slate-100 p-3 rounded-2xl text-sm" />
                                        </div>
                                    </div>
                                </div>
                            )}

                            {activeTab === 'publications' && (
                                <div className="space-y-4">
                                    <input value={formData.authors || ''} onChange={e=>setFormData({...formData, authors:e.target.value})} className="w-full border-2 border-slate-100 p-3 rounded-2xl" placeholder="ä½œè€…åˆ—è¡¨ (Authors)" />
                                    <div className="grid grid-cols-2 gap-3">
                                        <input type="date" required value={formData.fullDate || ''} onChange={e => {
                                            const d = e.target.value; const y = d ? new Date(d).getFullYear() : '';
                                            setFormData({...formData, fullDate: d, year: y.toString()});
                                        }} className="w-full border-2 border-slate-100 p-3 rounded-2xl text-sm" />
                                        <input value={formData.venue || ''} onChange={e=>setFormData({...formData, venue:e.target.value})} className="w-full border-2 border-slate-100 p-3 rounded-2xl text-sm" placeholder="æœŸåˆŠåç¨± (Venue)" />
                                    </div>
                                    <div className="p-4 bg-slate-50 rounded-2xl border border-slate-100">
                                        <div className="flex justify-between items-center mb-2"><span className="text-xs font-bold text-slate-600">PDF æª”æ¡ˆ (2MB å…§)</span></div>
                                        <input type="file" accept="application/pdf" onChange={handleFile} className="w-full text-xs" />
                                        {fileError && <p className="text-red-500 text-[10px] font-bold mt-1">{fileError}</p>}
                                        {formData.pdfName && <div className="mt-2 text-[10px] font-bold text-blue-600 truncate">ğŸ“„ {formData.pdfName}</div>}
                                    </div>
                                    <input value={formData.url || ''} onChange={e=>setFormData({...formData, url:e.target.value})} className="w-full border-2 border-blue-50 p-3 rounded-2xl bg-blue-50/20 text-xs" placeholder="æˆ–è¼¸å…¥é›²ç«¯ç¶²å€ URL" />
                                </div>
                            )}

                            {activeTab === 'news' && (
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <input type="date" value={formData.date||''} onChange={e=>setFormData({...formData, date:e.target.value})} className="border-2 border-slate-100 p-3 rounded-2xl" />
                                    <select value={formData.tag||'Activity'} onChange={e=>setFormData({...formData, tag:e.target.value})} className="border-2 border-slate-100 p-3 rounded-2xl">
                                        <option value="Activity">ä¸€èˆ¬å‹•æ…‹</option><option value="Award">æ¦®è­½ç²ç</option>
                                    </select>
                                </div>
                            )}

                            {activeTab === 'members' && (
                                <div className="space-y-4">
                                    <div className="grid grid-cols-2 gap-3">
                                        <select value={formData.type||'master'} onChange={e=>setFormData({...formData, type:e.target.value})} className="border-2 border-slate-100 p-3 rounded-2xl text-sm">
                                            <option value="pi">æŒ‡å°æ•™æˆ</option><option value="phd">åšå£«ç”Ÿ</option><option value="master">ç¢©å£«ç”Ÿ</option><option value="alumni">ç•¢æ¥­æ ¡å‹</option>
                                        </select>
                                        <input placeholder="å¹´ç´š (å¦‚ç¢©ä¸€)" value={formData.year||''} onChange={e=>setFormData({...formData, year:e.target.value})} className="border-2 border-slate-100 p-3 rounded-2xl text-sm" />
                                    </div>
                                    <textarea placeholder="ç ”ç©¶æ–¹å‘è©³ç´°å…§å®¹..." value={formData.researchDetail||''} onChange={e=>setFormData({...formData, researchDetail:e.target.value})} className="border-2 border-slate-100 p-3 rounded-2xl w-full h-24 text-sm" />
                                </div>
                            )}

                            {activeTab !== 'projects' && activeTab !== 'publications' && (
                                <div className="p-4 bg-slate-50 rounded-2xl">
                                    <label className="block text-xs font-bold text-slate-500 mb-2">åœ–ç‰‡ä¸Šå‚³</label>
                                    <input type="file" multiple={activeTab==='gallery'} accept="image/*" onChange={handleFile} className="w-full text-xs" />
                                    <div className="flex gap-2 mt-3 overflow-x-auto p-1">
                                        {(activeTab === 'gallery' ? galleryImages : [{src: formData.photo || formData.image}]).map((img, i) => img.src && (
                                            <img key={i} src={img.src} className="w-16 h-16 object-cover rounded-lg border shadow-sm" />
                                        ))}
                                    </div>
                                </div>
                            )}

                            <div className="flex gap-3 pt-6 border-t">
                                <button type="button" onClick={onClose} className="flex-1 py-3 border-2 rounded-2xl font-bold text-slate-400">å–æ¶ˆ</button>
                                <button type="submit" disabled={isSaving} className="flex-1 py-3 bg-blue-600 text-white rounded-2xl font-black shadow-lg shadow-blue-100 disabled:opacity-50">
                                    {isSaving ? 'è™•ç†ä¸­' : 'å„²å­˜'}
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        };

        const AdminApp = () => {
            const [isLoggedIn, setIsLoggedIn] = useState(false);
            const [tab, setTab] = useState('news');
            const [dataList, setDataList] = useState([]);
            const [loading, setLoading] = useState(false);
            const [editing, setEditing] = useState(null);
            const [isPwdModalOpen, setIsPwdModalOpen] = useState(false);
            const [isSidebarOpen, setIsSidebarOpen] = useState(false);
            const [supabase, setSupabase] = useState(null);

            useEffect(() => {
                setSupabase(window.supabase.createClient(supabaseUrl, supabaseKey));
            }, []);

            const loadData = async () => {
                if (!supabase) return;
                setLoading(true);
                const { data, error } = await supabase.from('lab_content').select('id, data').eq('collection', tab).order('created_at', { ascending: false });
                if (!error) setDataList(data.map(r => ({ id: r.id, ...r.data })));
                setLoading(false);
            };

            useEffect(() => { if (isLoggedIn && supabase) loadData(); }, [isLoggedIn, tab, supabase]);

            const handleSave = async (payload) => {
                const dataToSave = { collection: tab, data: { ...payload, updatedAt: Date.now() } };
                if (!payload.id) await supabase.from('lab_content').insert(dataToSave);
                else await supabase.from('lab_content').update({ data: payload }).eq('id', payload.id);
                loadData();
            };

            const handleBatchSave = async (items) => {
                const rows = items.map(item => ({ collection: tab, data: { ...item, createdAt: Date.now() } }));
                await supabase.from('lab_content').insert(rows);
                loadData();
            };

            const handleDelete = async (id) => {
                if (confirm('ç¢ºå®šè¦åˆªé™¤å—ï¼Ÿ')) { await supabase.from('lab_content').delete().eq('id', id); loadData(); }
            };

            if (!isLoggedIn) return <LoginForm onLogin={() => setIsLoggedIn(true)} />;

            return (
                <div className="min-h-screen flex flex-col md:flex-row bg-slate-50 font-sans">
                    
                    {/* Mobile Header */}
                    <div className="md:hidden bg-slate-900 text-white p-4 flex justify-between items-center sticky top-0 z-50">
                        <div className="font-black text-blue-400">SMSMP LAB</div>
                        <button onClick={()=>setIsSidebarOpen(!isSidebarOpen)} className="p-2 bg-slate-800 rounded-lg text-white">
                            {isSidebarOpen ? <CloseIcon /> : <MenuIcon />}
                        </button>
                    </div>

                    {/* Sidebar */}
                    <aside className={`fixed md:sticky top-0 left-0 h-screen w-72 bg-slate-900 text-white p-8 flex-shrink-0 shadow-2xl flex flex-col z-[100] sidebar-transition transform ${isSidebarOpen ? 'translate-x-0' : '-translate-x-full md:translate-x-0'}`}>
                        <div className="mb-12 hidden md:block text-center">
                            <h1 className="text-2xl font-black text-blue-400 tracking-tighter">SMSMP LAB</h1>
                            <p className="text-slate-500 text-[10px] uppercase font-bold tracking-widest mt-1">Administrator</p>
                        </div>
                        <nav className="space-y-1 flex-grow">
                            {Object.entries(TAB_NAMES).map(([key, label]) => (
                                <button key={key} onClick={() => { setTab(key); setIsSidebarOpen(false); }} 
                                        className={`w-full text-left px-5 py-4 rounded-2xl transition-all font-bold flex items-center gap-3 ${tab===key ? 'bg-blue-600 shadow-lg scale-105' : 'hover:bg-slate-800 text-slate-400'}`}>
                                    <div className={`w-1.5 h-1.5 rounded-full ${tab===key ? 'bg-white' : 'bg-transparent'}`}></div>
                                    {label}
                                </button>
                            ))}
                            <div className="mt-8 pt-8 border-t border-slate-800 space-y-2">
                                <button onClick={() => {setIsPwdModalOpen(true); setIsSidebarOpen(false);}} className="w-full text-left px-5 py-4 rounded-2xl font-bold text-blue-400 border border-blue-900/30 hover:bg-blue-900/20 transition-all text-sm">ğŸ”’ ä¿®æ”¹ç®¡ç†å¯†ç¢¼</button>
                                <a href="./index.html" className="w-full text-left px-5 py-4 rounded-2xl font-bold text-slate-400 hover:bg-slate-800 transition-all text-sm">ğŸ  è¿”å›å‰å°ç¶²é </a>
                            </div>
                        </nav>
                        <button onClick={() => window.location.reload()} className="mt-8 pt-6 border-t border-slate-800 text-xs text-slate-600 font-bold hover:text-slate-400 text-left">ç™»å‡ºç³»çµ±</button>
                    </aside>

                    {/* Overlay for Mobile Sidebar */}
                    {isSidebarOpen && <div onClick={()=>setIsSidebarOpen(false)} className="fixed inset-0 bg-black/60 z-[90] md:hidden backdrop-blur-sm"></div>}
                    
                    <main className="flex-grow p-4 md:p-12 overflow-y-auto h-screen custom-scrollbar">
                        <header className="flex flex-col md:flex-row justify-between items-start md:items-end mb-8 md:mb-12 gap-4">
                            <div>
                                <h2 className="text-3xl md:text-5xl font-black text-slate-800 tracking-tight">{TAB_NAMES[tab]}</h2>
                                <p className="text-slate-400 mt-2 font-medium hidden md:block">ç®¡ç†å¯¦é©—å®¤ç¶²ç«™å…§å®¹</p>
                            </div>
                            <button onClick={() => setEditing({})} className="w-full md:w-auto bg-blue-600 text-white px-8 py-4 rounded-2xl shadow-xl shadow-blue-200 hover:bg-blue-700 font-black transition-all">+ æ–°å¢{TAB_NAMES[tab]}</button>
                        </header>

                        <div className="bg-white rounded-[24px] md:rounded-[40px] shadow-sm border border-slate-200 overflow-hidden">
                            {/* Desktop View Table */}
                            <table className="w-full text-left hidden md:table">
                                <thead className="bg-slate-50 border-b"><tr className="text-slate-500 text-xs uppercase font-black tracking-widest"><th className="p-8">å…§å®¹æè¿°</th><th className="p-8 text-right">ç®¡ç†æ“ä½œ</th></tr></thead>
                                <tbody className="divide-y divide-slate-100">
                                    {dataList.map(item => (
                                        <tr key={item.id} className="hover:bg-slate-50/50 transition-colors group">
                                            <td className="p-8">
                                                <div className="font-black text-slate-800 text-lg">{item.title || item.name}</div>
                                                <div className="text-[11px] text-slate-400 font-bold mt-1 flex gap-4 uppercase tracking-tighter">
                                                    {item.planYear && <span className="text-blue-500 px-2 py-0.5 bg-blue-50 rounded">è¨ˆç•«å¹´åº¦: {item.planYear}</span>}
                                                    {item.execYear && <span className="text-slate-500 px-2 py-0.5 bg-slate-100 rounded">åŸ·è¡Œå¹´åº¦: {item.execYear}</span>}
                                                    {!item.planYear && <span>{item.year || item.date || '----'}</span>}
                                                </div>
                                            </td>
                                            <td className="p-8 text-right space-x-4">
                                                <button onClick={() => setEditing(item)} className="text-blue-600 font-black hover:underline transition-all">ç·¨è¼¯</button>
                                                <button onClick={() => handleDelete(item.id)} className="text-red-400 font-bold hover:underline transition-all">åˆªé™¤</button>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>

                            {/* Mobile View Cards */}
                            <div className="md:hidden divide-y divide-slate-100">
                                {dataList.map(item => (
                                    <div key={item.id} className="p-5 space-y-3">
                                        <div>
                                            <div className="font-black text-slate-800">{item.title || item.name}</div>
                                            <div className="text-[10px] text-slate-400 font-bold mt-1 flex flex-wrap gap-2">
                                                {item.planYear && <span className="bg-blue-50 text-blue-600 px-2 py-0.5 rounded">å¹´åº¦: {item.planYear}</span>}
                                                {item.tag && <span className="bg-slate-100 text-slate-500 px-2 py-0.5 rounded">{item.tag}</span>}
                                                {!item.planYear && <span>{item.year || item.date || '----'}</span>}
                                            </div>
                                        </div>
                                        <div className="flex gap-2">
                                            <button onClick={() => setEditing(item)} className="flex-1 bg-slate-50 py-3 rounded-xl text-blue-600 font-black text-sm">ç·¨è¼¯</button>
                                            <button onClick={() => handleDelete(item.id)} className="flex-1 bg-slate-50 py-3 rounded-xl text-red-400 font-black text-sm">åˆªé™¤</button>
                                        </div>
                                    </div>
                                ))}
                            </div>
                            {dataList.length === 0 && <div className="p-20 text-center text-slate-300 font-bold">ç›®å‰æš«ç„¡è³‡æ–™</div>}
                        </div>
                    </main>
                    {editing && <EditorModal activeTab={tab} initData={editing} onSave={handleSave} onBatchSave={handleBatchSave} onClose={() => setEditing(null)} />}
                    <ChangePasswordModal isOpen={isPwdModalOpen} onClose={() => setIsPwdModalOpen(false)} />
                </div>
            );
        };

        const rootElement = document.getElementById('root');
        if (rootElement) {
            ReactDOM.createRoot(rootElement).render(<AdminApp />);
        }
    </script>
</body>
</html>